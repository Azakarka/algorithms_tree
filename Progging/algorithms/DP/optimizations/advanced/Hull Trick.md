# Не доделано


# Трюки с выпуклой оболочкой


## Предисловие
В общем, на самом деле CHT работает за линию только при некоторых условиях, а динамическое CHT пишется за nlog использую set-ы. Но, на самом деле, обычно в сто раз удобнее и надежнее написать Li Chao tree, который находится в папочке data sctucture.

## Поставновка задачи
Есть n прямоугольников левый нижний конец которых находится в координате (0;0). Они не вложены, то есть ни один прямоугольник полгостью не лежит в другом. У каждого прямоугольника есть какая-то стоимость c[i]. Нужно выбрать несколько (или 0) из них так, чтобы суммарная занимаемая площадь - суммарная стоимость была максимальна.

## Тупняк
Отсортим по x по возрастанию. Раз вложенных нет, то y будет уменьшатся, тогда не тяжело придумать такую динамику:

dp[i] = max(dp[j] + a[j].y * (a[i].x - a[j].x) - c[i])

Итоговая асимптотика O(n ^ 2)

## Алгоритм

dp[j] + a[j].y * (a[i].x - a[j].x) - c[i] очень интересно выглядит, попробуем разгруппировать части выражения.

1) То, что зависит от i: - c[i]
2) То, что зависит от j: dp[j] + a[j].y * a[j].x
3) То, что зависит от них обоих: a[j].y * a[i].x

Первую группу мы вообще вынесем за скобки, так как ее можно вычесть потом. Остается только от j и от обоих. Заметим некоторое сходство 2 и 3 группы с прямыми вида *kx + b*.

Действительно, если мы зададим

1)  k = a[j].y
2)  x = a[i].x
3)  b = dp[j] + a[j].x * a[j].y

то получим некоторую прямую. 

Итого: наша задача свелась к следующей:

*Написать структуру данных, которая умеет добавлять прямые вида kx + b и брать min/max ответ в точке x*.

Как это сделать?

## Выпуклая Оболочка

Собственно, в честь которой и назван алгоритм. Что такое выпуклая оболочка? 

Какой-то многоугольник считается выпуклым тогда и только тогда, когда мы можем взять любые две точки внутри многоугольника и отрезок, соединяющий их, тоже будет лежать внутри на всем своем промежутке

Пример выпуклого: 
![[выпуклость.png]]

и невыпуклого соотвественно:
![[невыпуклость.png]]

На примере невыпуклого видно, что нашелся такой отрезок, который выходит за границы многоугольника

Как строить выпукую оболочку есть (или будет) в разделе геометрия, тут мы просто поговорим зачем же она нам нужна.

Вернее не сама она, а ее верхняя\ нижняя полуплоскость. 

Для удобства возьмем, что нам нужна выпуклая оболочка на минимум, то есть ее нижняя полуклоскость. 

Мы будем строить выпуклую оболочку на прямых, а потом просто брать ответ от нее в точке.


## Продолжение алгоритма

Повторю задачу:

*Даются прямые вида kx + b, нужно ответить на запрос в точке x*

На самом деле сейчас мы рассмотрим случай, когда k монотона, случаи когда k любое и b любое обычно делается динамическим CHT (или Li Chao), но иногда все равно можно найти лазейку и заметить некоторую монотонность.


Итак, K монотона. А конекретно в нашем случае она убывает. 

Пусть у нас уже есть какой-то набор линий, которые заданы в порядке их "доминатности", то есть отрезке, где у них самое маленькое значение.